<!doctype html>
<html lang="hi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Rajasthan Exam Quiz Portal</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    :root { --accent: #0ea5a4; }
    .focus-ring:focus { outline: 3px solid rgba(14,165,164,0.3); outline-offset: 2px; }
  </style>
</head>
<body class="bg-slate-50 text-slate-900 min-h-screen flex items-center justify-center p-4">
  <main class="w-full max-w-3xl bg-white rounded-2xl shadow-lg p-6">
    <header class="mb-4 text-center">
      <h1 class="text-2xl font-semibold text-indigo-700">Rajasthan Exams Quiz Portal</h1>
      <p class="text-sm text-slate-500">Select exam and test your knowledge!</p>
    </header>

    <!-- Setup Panel -->
    <section id="setup" class="space-y-3">
      <div class="grid grid-cols-1 sm:grid-cols-2 gap-2">
        <select id="examSelect" class="focus-ring p-2 border rounded">
          <option value="">-- परीक्षा चुनें --</option>
          <option value="vdo">VDO (Village Development Officer)</option>
          <option value="ras">RAS (Rajasthan Administrative Service)</option>
          <option value="police">Delhi Police Constable</option>
          <option value="ldc">LDC (Lower Division Clerk)</option>
          <option value="firstGrade">1st Grade Teacher</option>
          <option value="firstGrade">Rs-Cit Test</option>

        </select>
        <input id="qty" type="number" min="10" max="100" value="50" class="focus-ring p-2 border rounded" />
      </div>
      <div class="flex gap-2">
        <button id="startBtn" class="px-4 py-2 bg-teal-500 text-white rounded hover:bg-teal-600">Start Quiz</button>
      </div>
    </section>

    <!-- Quiz Area -->
    <section id="quizArea" class="mt-6 hidden" aria-live="polite">
      <div id="progress" class="text-sm text-slate-600 mb-2">Question <span id="qIndex">1</span>/<span id="qTotal">5</span></div>

      <article id="questionCard" class="p-4 bg-slate-50 rounded-lg border">
        <h2 id="questionText" class="font-medium text-lg">Question text will appear here</h2>
        <div id="options" class="mt-3 grid gap-2"></div>
      </article>

      <div class="mt-4 flex items-center justify-between">
        <div class="flex gap-2">
          <button id="prevBtn" class="px-3 py-2 border rounded">Prev</button>
          <button id="nextBtn" class="px-3 py-2 bg-indigo-600 text-white rounded">Next</button>
        </div>
        <div class="text-sm text-slate-500">Score: <span id="score">0</span></div>
      </div>

      <div id="explain" class="mt-4 p-3 bg-white border rounded hidden">
        <strong>Explanation:</strong>
        <p id="explainText" class="mt-2 text-sm text-slate-700"></p>
      </div>
    </section>

    <!-- Result -->
    <section id="resultArea" class="mt-6 hidden text-center">
      <h3 class="text-xl font-semibold">Result</h3>
      <p class="mt-2">Your score: <span id="finalScore"></span></p>
      <button id="restartBtn" class="mt-4 px-4 py-2 bg-green-500 text-white rounded">Restart</button>
    </section>
  </main>

  <script type="module">
    const examSelect = document.getElementById('examSelect');
    const qtyInput = document.getElementById('qty');
    const startBtn = document.getElementById('startBtn');
    const quizArea = document.getElementById('quizArea');
    const setup = document.getElementById('setup');
    const qIndexEl = document.getElementById('qIndex');
    const qTotalEl = document.getElementById('qTotal');
    const questionText = document.getElementById('questionText');
    const optionsEl = document.getElementById('options');
    const scoreEl = document.getElementById('score');
    const explain = document.getElementById('explain');
    const explainText = document.getElementById('explainText');
    const prevBtn = document.getElementById('prevBtn');
    const nextBtn = document.getElementById('nextBtn');
    const resultArea = document.getElementById('resultArea');
    const finalScore = document.getElementById('finalScore');
    const restartBtn = document.getElementById('restartBtn');

    let state = { questions: [], index: 0, score: 0, answers: [] };

    // Render Question
    function renderQuestion() {
      const q = state.questions[state.index];
      qIndexEl.textContent = state.index + 1;
      qTotalEl.textContent = state.questions.length;
      questionText.textContent = q.question;
      optionsEl.innerHTML = '';
      explain.classList.add('hidden');
      q.options.forEach((opt, i) => {
        const btn = document.createElement('button');
        btn.className = 'text-left p-3 border rounded w-full focus-ring';
        btn.textContent = opt;
        btn.onclick = () => selectOption(i);
        optionsEl.appendChild(btn);
      });
    }

    function selectOption(choice) {
      const q = state.questions[state.index];
      const correct = q.answer_index;
      Array.from(optionsEl.children).forEach(b => b.disabled = true);
      const chosenBtn = optionsEl.children[choice];
      if (choice === correct) {
        chosenBtn.classList.add('bg-green-100', 'border-green-400');
        state.score++;
        scoreEl.textContent = state.score;
      } else {
        chosenBtn.classList.add('bg-red-100', 'border-red-400');
        optionsEl.children[correct]?.classList.add('bg-green-100', 'border-green-400');
      }
      explainText.textContent = q.explanation || "No explanation provided.";
      explain.classList.remove('hidden');
      state.answers[state.index] = { chosen: choice, correct };
    }

    prevBtn.onclick = () => {
      if (state.index > 0) { state.index--; renderQuestion(); }
    };
    nextBtn.onclick = () => {
      if (state.index < state.questions.length - 1) { state.index++; renderQuestion(); }
      else finishQuiz();
    };
    restartBtn.onclick = () => location.reload();

    function finishQuiz() {
      quizArea.classList.add('hidden');
      resultArea.classList.remove('hidden');
      finalScore.textContent = `${state.score} / ${state.questions.length}`;
    }

    // Start Quiz
    startBtn.addEventListener('click', async () => {
      const exam = examSelect.value;
      if (!exam) return alert('कृपया परीक्षा चुनें!');
      const qty = Number(qtyInput.value) || 5;

      try {
        const module = await import(`./data/${exam}Data.js`);
        const dataKey = Object.keys(module)[0];
        const allQs = module[dataKey];
        state.questions = allQs.slice(0, qty);
        state.index = 0;
        state.score = 0;
        setup.classList.add('hidden');
        quizArea.classList.remove('hidden');
        renderQuestion();
      } catch (err) {
        alert('डेटा लोड नहीं हुआ! कृपया सही exam चुनें।');
        console.error(err);
      }
    });
  </script>
</body>
</html>
